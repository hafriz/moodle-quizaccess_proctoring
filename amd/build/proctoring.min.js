var isCameraAllowed=!1;define(["jquery","core/ajax","core/notification"],function(u,l,m){function c(){u(".mod_quiz-next-nav").prop("disabled",!0),u(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}u(function(){u("#id_submitbutton").prop("disabled",!0),u("#id_proctoring").on("change",function(){this.checked&&isCameraAllowed?u("#id_submitbutton").prop("disabled",!1):u("#id_submitbutton").prop("disabled",!0)})});var g;return{setup:function(i){if(g=i.frequency,null!==document.getElementById("page-mod-quiz-summary")&&document.getElementById("page-mod-quiz-summary").innerHTML.length)return!1;if(null!==document.getElementById("page-mod-quiz-review")&&document.getElementById("page-mod-quiz-review").innerHTML.length)return!1;var n=i.image_width,a=0,e=!1,o=null;console.log("freq paisi:",g),console.log("width paisi:",n),u("#mod_quiz_navblock").append('<div class="card-body p-3"><h3 class="no text-left">Webcam</h3> <br/><video id="video">Video stream not available.</video><canvas id="canvas" style="display:none;"></canvas><div class="output" style="display:none;"><img id="photo" alt="The picture will appear in this box."/></div></div>');function t(){var e,t=r.getContext("2d");n&&a?(r.width=n,r.height=a,t.drawImage(d,0,0,n,a),o=r.toDataURL("image/png"),s.setAttribute("src",o),i.webcampicture=o,e={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:i.courseid,screenshotid:i.id,quizid:i.quizid,webcampicture:o}},l.call([e])[0].done(function(e){e.warnings.length<1||d&&m.addNotification({message:"Something went wrong during taking the image.",type:"error"})}).fail(m.exception)):((e=r.getContext("2d")).fillStyle="#AAA",e.fillRect(0,0,r.width,r.height),o=r.toDataURL("image/png"),s.setAttribute("src",o))}var d=document.getElementById("video"),r=document.getElementById("canvas"),s=document.getElementById("photo");return navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){d.srcObject=e,d.play(),isCameraAllowed=!0}).catch(function(){c()}),d?(d.addEventListener("canplay",function(){e||(a=d.videoHeight/(d.videoWidth/n),isNaN(a)&&(a=n/(4/3)),d.setAttribute("width",n),d.setAttribute("height",a),r.setAttribute("width",n),r.setAttribute("height",a),e=!0)},!1),d.addEventListener("click",function(e){t(),e.preventDefault()},!1),setTimeout(t,3e3),setInterval(t,g)):c(),!0},init:function(i){var n=320,a=0,e=!1,o=null,d=null,r=null,s=null;function c(){var e;isCameraAllowed?((e=d.getContext("2d")).fillStyle="#AAA",e.fillRect(0,0,d.width,d.height),s=d.toDataURL("image/png"),r.setAttribute("src",s)):t()}function t(){u(".mod_quiz-next-nav").prop("disabled",!0),u(".submitbtns").html('<p class="text text-red red">You need to enable web camera before submitting this quiz!</p>')}return o=document.getElementById("video"),d=document.getElementById("canvas"),r=document.getElementById("photo"),o?(navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(e){o.srcObject=e,o.play(),isCameraAllowed=!0}).catch(function(){m.addNotification({message:"Please allow camera access in your browser.",type:"warning"}),t()}),o.addEventListener("canplay",function(){e||(a=o.videoHeight/(o.videoWidth/n),isNaN(a)&&(a=n/(4/3)),o.setAttribute("width",n),o.setAttribute("height",a),d.setAttribute("width",n),d.setAttribute("height",a),e=!0)},!1),o.addEventListener("click",function(e){var t;t=d.getContext("2d"),n&&a?(d.width=n,d.height=a,t.drawImage(o,0,0,n,a),s=d.toDataURL("image/png"),r.setAttribute("src",s),t={methodname:"quizaccess_proctoring_send_camshot",args:{courseid:i.courseid,screenshotid:i.id,quizid:i.quizid,webcampicture:s}},l.call([t])[0].done(function(e){e.warnings.length<1||m.addNotification({message:"Something went wrong during taking screenshot.",type:"error"})}).fail(m.exception)):c(),e.preventDefault()},!1)):t(),c(),s}}});
//# sourceMappingURL=proctoring.min.js.map
